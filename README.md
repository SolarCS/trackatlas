# trackatlas
Collection of NodeJS/Python code to gather Evolve Database data and to process and generate reports
## Installation
~~~~
pip3 install pandas
npm install
~~~~

## Scripts
### filter_test_care_providers
Reads the Care Providers collection and generates 3 separate CSV files:
- care_providers_list: Summary of all care providers in the database
- test_demo_canceled_care_providers_list: Summary of care providers that have been tagged Demo/Test/Cancelled 
- actual_care_providers_list: Care providers that aren't tagged as Demo/Test/Cancelled

Each of these reports has the following information:
- care provider id
- care provider name
- created at date in human readable format
- created at date in epoch time (for excel sorting)
- last updated at date in human readable format
- last updated at date in epoch time (for excel sorting)
- a list of tags associated with the database

All reports are written to ./reports
### fetch_care_provider_usage_report
Generates a CSV file documenting the number of documents associated with a particular care provider for the following collections:
- Patients
- Encounters
- Interactions
- Enrollments
- CallAttempts
- ArchivedCallAttempts
- PatientIssues
- PatientEvents
- UnitVisits

The report can be generated for either the Demo/Test/Cancelled care providers or the "actual" care providers

### fetch_care_provider_document_age.js
Generates a CSV file documenting the number of documents associated with a particular care provider before a given date
for the following collections:
- Patients
- Encounters
- Interactions
- Enrollments
- CallAttempts
- ArchivedCallAttempts
- PatientIssues
- PatientEvents
- UnitVisits

### fetch_evolve_collections_list.js
Generates a txt file (./reports/collection_list.txt) containing the names of all collections in the banff database

### banff_collection_stats.js
Generates a csv file (./reports/collectionStats.csv) containing the collection stats for each collection in banff. Reports on the 
following data:
- namespace
- collectionSize
- docCount
- avgObjSize
- storageSize
- numIndexes
- totalIndexSize

### canceled_provider_collection_usage
Uses an aggregatation pipeline to search the database collections against a list of cancelled care provider ids to determine
how many documents are in each collection for that cancelled provider. Generates a _canceled.json_ file in 
./reports/canceled_care_providers.

### cancelled_stats.py
Takes the _canceled.json_ file generated by canceled_provider_collection_usage, and uses the Python library Pandas to perform 
some data analysis operations to calculate total document counts by cancelled care provider, collection and total docs. Also
uses the ./reports/collectionStats.csv table to calculate the total byte sizes allocated.

~~~~
node banff_collection_stats.js 
node canceled_provider_collection_usage.js 
python cancelled_stats.py 
~~~~

## Sequence
~~~~
$ node filter_test_care_providers.js
$ python3 filter_canceled_care_providers.py --test_canceled_csv_loc ../reports/April2022/test_demo_canceled_care_providers_list.csv --report_output ../reports/April2022/canceled_care_providers_list.csv 
$ python3 compare_actual_providers.py --Source1 ../reports/Oct2021/cancelled_care_providers.csv --Source2 ../reports/April2022/canceled_care_providers_list.csv --Output ../reports/April2022/new_canceled_care_providers.csv
~~~~